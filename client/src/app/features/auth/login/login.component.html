<div
  class="min-h-screen bg-brand-background flex items-center justify-center p-4"
>
  <div class="w-full max-w-md">
    <div class="text-center mb-8">
      <a routerLink="/" class="text-4xl font-bold text-brand-accent"
        >Vibe Vault</a
      >
      <p class="text-brand-text-secondary mt-2">
        Faça login para acessar sua conta.
      </p>
    </div>

    <form
      [formGroup]="loginForm"
      (ngSubmit)="onSubmit()"
      class="bg-brand-surface shadow-lg rounded-lg p-8 space-y-6"
    >
      <div class="form-control">
        <label
          for="email"
          class="block text-sm font-medium text-brand-text-secondary"
          >Email</label
        >
        <input
          id="email"
          type="email"
          formControlName="email"
          class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-brand-accent"
        />
      </div>
      <div class="form-control">
        <label
          for="password"
          class="block text-sm font-medium text-brand-text-secondary"
          >Senha</label
        >
        <input
          id="password"
          type="password"
          formControlName="password"
          class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-brand-accent"
        />
      </div>
      <div>
        <button
          type="submit"
          [disabled]="loginForm.invalid"
          class="w-full bg-brand-accent text-brand-background font-bold py-3 px-4 rounded-lg hover:bg-lime-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          Entrar
        </button>
      </div>

      <div class="text-center text-sm">
        <a
          (click)="showForgotPasswordDialog()"
          class="text-brand-accent hover:underline cursor-pointer"
          >Esqueceu sua senha?</a
        >
      </div>
      <div class="text-center text-sm text-brand-text-secondary">
        Não tem uma conta?
        <a
          routerLink="/register"
          class="font-medium text-brand-accent hover:underline"
          >Registre-se</a
        >
      </div>
    </form>
  </div>
</div>

<p-dialog
  header="Recuperar Senha"
  [(visible)]="displayForgotPasswordDialog"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="resetForm" class="p-4">
    <div *ngIf="resetStep === 1">
      <p class="mb-4 text-brand-text-secondary">
        Digite seu e-mail para enviarmos um código de verificação.
      </p>
      <div class="flex flex-col gap-2">
        <label for="reset-email" class="text-brand-text-secondary"
          >E-mail</label
        >
        <input
          id="reset-email"
          type="email"
          pInputText
          formControlName="email"
        />
      </div>
    </div>

    <div *ngIf="resetStep === 2">
      <p class="mb-4 text-brand-text-secondary">
        Enviamos um código de 6 dígitos para
        <strong class="text-white">{{ resetForm.get("email")?.value }}</strong
        >. Verifique sua caixa de entrada.
      </p>
      <div class="flex flex-col gap-2">
        <label for="code" class="text-brand-text-secondary"
          >Código de Verificação</label
        >
        <input id="code" type="text" pInputText formControlName="code" />
      </div>
    </div>

    <div *ngIf="resetStep === 3" class="space-y-4">
      <p class="text-brand-text-secondary">
        Código verificado! Agora, crie uma nova senha.
      </p>
      <div class="flex flex-col gap-2">
        <label for="password" class="text-brand-text-secondary"
          >Nova Senha</label
        >
        <input
          id="password"
          type="password"
          pInputText
          formControlName="password"
        />
      </div>
      <div class="flex flex-col gap-2">
        <label for="confirmPassword" class="text-brand-text-secondary"
          >Confirme a Nova Senha</label
        >
        <input
          id="confirmPassword"
          type="password"
          pInputText
          formControlName="confirmPassword"
        />
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancelar"
      (click)="displayForgotPasswordDialog = false"
      styleClass="p-button-text"
    ></p-button>

    <p-button
      *ngIf="resetStep === 1"
      label="Enviar Código"
      (click)="requestResetCode()"
      [loading]="isLoading"
    ></p-button>
    <p-button
      *ngIf="resetStep === 2"
      label="Verificar Código"
      (click)="submitVerificationCode()"
      [loading]="isLoading"
    ></p-button>
    <p-button
      *ngIf="resetStep === 3"
      label="Redefinir Senha"
      (click)="submitNewPassword()"
      [loading]="isLoading"
    ></p-button>
  </ng-template>
</p-dialog>
